<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Lumen by wordsandwriting</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Lumen</h1>
        <p>Open-source group discussion platform. Written in Ruby (Padrino), hosted via Heroku (web) and Virtualmin (email)</p>

        <p class="view"><a href="https://github.com/wordsandwriting/lumen">View the Project on GitHub <small>wordsandwriting/lumen</small></a></p>


        <ul>
          <li><a href="https://github.com/wordsandwriting/lumen/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/wordsandwriting/lumen/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/wordsandwriting/lumen">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="lumen" class="anchor" href="#lumen" aria-hidden="true"><span class="octicon octicon-link"></span></a>Lumen</h1>

<p><a href="https://travis-ci.org/wordsandwriting/lumen"><img src="https://travis-ci.org/wordsandwriting/lumen.png?branch=master" alt="Build Status"></a>
<a href="https://codeclimate.com/github/wordsandwriting/lumen"><img src="https://codeclimate.com/github/wordsandwriting/lumen.png" alt="Code Climate"></a></p>

<p><strong>For a live preview of Lumen, feel free to <a href="http://www.lumenapp.com/groups/previewers/request_membership">request access to the previewers group on lumenapp.com</a>.</strong></p>

<p>Lumen started life as a group discussion platform akin to <a href="http://groups.google.com">Google Groups</a>, <a href="http://groupserver.org/">GroupServer</a>, 
<a href="http://www.list.org/">Mailman</a> or <a href="http://www.sympa.org/">Sympa</a>. Since then, it's gained some powerful extras. An outline of its features:</p>

<ul>
<li>Open-source (under <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported</a>)</li>
<li>Hosted using dokku or Heroku (web app), Amazon S3 (file attachments) and a VPS (mail sever). You can run dokku and the mail server on the same VPS.</li>
<li>Designed for custom domains (group email addresses of the form <a href="mailto:yourgroup@yourdomain.org">yourgroup@yourdomain.org</a>)</li>
<li>Sends and receives mail via regular SMTP and IMAP accounts</li>
<li>Dual web/email access</li>
<li>Extensible member profiles</li>
<li>Flexible digest engine</li>
<li>Events calendar</li>
<li>Daily summaries of news stories tweeted by group members via news.me integration</li>
<li>Maps placing people, organisations and venues</li>
<li>Google Docs integration</li>
<li>Facebook-style walls</li>
<li>Google Spreadsheets-like surveys feature</li>
</ul>

<p>Lumen is written in Ruby using the <a href="http://padrinorb.com/">Padrino</a> framework. It was originally created for the <a href="http://neweconomyorganisersnetwork.org/">New Economy Organisers Network</a> (hosted by the <a href="http://neweconomics.org/">New Economics Foundation</a>) who kindly agreed to open source the project and continue to sponsor its development.</p>

<p><a href="http://wordsandwriting.github.io/lumen/images/top.jpg"><img src="http://wordsandwriting.github.io/lumen/images/top.jpg"></a></p>

<p>See below for more images.</p>

<h2>
<a id="how-the-mailing-lists-work-in-brief" class="anchor" href="#how-the-mailing-lists-work-in-brief" aria-hidden="true"><span class="octicon octicon-link"></span></a> How the mailing lists work, in brief</h2>

<ol>
<li>Your mail server receives a mail to <a href="mailto:yourgroup@yourdomain.org">yourgroup@yourdomain.org</a>
</li>
<li>The mail triggers a simple notification script on the mail server that in turn alerts your web app to the fact there's a new message for the group</li>
<li>Your web app connects to the mail server via IMAP to fetch the new mail</li>
<li>Your web app distributes the message to group members via SMTP</li>
</ol>

<h2>
<a id="getting-up-and-running" class="anchor" href="#getting-up-and-running" aria-hidden="true"><span class="octicon octicon-link"></span></a>Getting up and running</h2>

<h3>
<a id="1-register-a-domain" class="anchor" href="#1-register-a-domain" aria-hidden="true"><span class="octicon octicon-link"></span></a>1. Register a domain</h3>

<p>We'll add the DNS records shortly.</p>

<h3>
<a id="2-set-up-the-mail-server" class="anchor" href="#2-set-up-the-mail-server" aria-hidden="true"><span class="octicon octicon-link"></span></a>2. Set up the mail server</h3>

<p>Purchase a VPS (Try <a href="http://www.ramnode.com/">RamNode</a> or <a href="http://www.digitalocean.com">Digital Ocean</a>, 512mb RAM should do). If in doubt use <code>mail.yourdomain.org</code> as the hostname and choose Ubuntu 14.04 64-bit as your operating system.
Make sure you obtain a password for the root user. (Since we're using password authentication, it's highly recommended that you install <a href="https://www.liberiangeek.net/2014/10/install-configure-fail2ban-ubuntu-14-04-servers/">fail2ban</a>.)</p>

<p>Follow the guide on <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-postfix-e-mail-server-with-dovecot">How To Set Up a Postfix E-Mail Server with Dovecot</a> and
then the guide on <a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-dkim-with-postfix-on-debian-wheezy">How To Install and Configure DKIM with Postfix</a>.</p>

<p>Add the following lines to <code>/etc/postfix/main.cf</code>:</p>

<pre><code>virtual_alias_domains = lists.lumenapp.com
virtual_alias_maps = hash:/etc/postfix/virtual
home_mailbox = Maildir/
</code></pre>

<p>In <code>nano /etc/dovecot/dovecot.conf</code>, change <code>mail_location = mbox:~/mail:INBOX=/var/mail/%u</code> to</p>

<pre><code>mail_location = maildir:~/Maildir
</code></pre>

<p>In <code>/etc/opendkim.conf</code>, add the line</p>

<pre><code>SenderHeaders           Sender,From
</code></pre>

<p>Restart postfix, dovecot and opendkim.</p>

<h3>
<a id="3-set-up-the-web-app" class="anchor" href="#3-set-up-the-web-app" aria-hidden="true"><span class="octicon octicon-link"></span></a>3. Set up the web app</h3>

<p>Clone the Lumen repo and push it to dokku/Heroku.</p>

<p>Prepare a MongoDB database: you can use <a href="https://github.com/jeffutter/dokku-mongodb-plugin">dokku-mongodb-plugin</a> on dokku
or <a href="https://addons.heroku.com/mongolab">MongoLab</a> on Heroku.</p>

<p>Optionally, add a custom domain (see instructions for <a href="http://progrium.viewdocs.io/dokku/nginx">dokku</a> or <a href="https://devcenter.heroku.com/articles/custom-domains">Heroku</a>.)</p>

<p>Set the following configuration variables:</p>

<pre><code>APP_NAME=yourappname DOMAIN=www.yourdomain.org MAIL_DOMAIN=yourdomain.org MONGO_URL=yourmongourl MAIL_SERVER_ADDRESS=yourmailserveraddress MAIL_SERVER_USERNAME=root MAIL_SERVER_PASSWORD=yourmailserverpassword S3_BUCKET_NAME=yourbucketname S3_ACCESS_KEY=youraccesskey S3_SECRET=yours3secret AIRBRAKE_HOST=yourairbrakehost AIRBRAKE_API_KEY=yourairbrakeapikey SESSION_SECRET=somelongsecretstring DRAGONFLY_SECRET=somelongsecretstring
</code></pre>

<p>If using Heroku, also set <code>HEROKU_OAUTH_TOKEN</code> (see <a href="https://github.com/heroku/platform-api">https://github.com/heroku/platform-api</a> for details of how to generate it).</p>

<p>Run <code>rake languages:default[English,en]</code> to set a default language and <code>rake mi:create_indexes</code> to create the database indexes.</p>

<p>Schedule the following tasks using <a href="https://www.digitalocean.com/community/tutorials/how-to-use-cron-to-automate-tasks-on-a-vps">cron</a> (dokku) or the <a href="https://devcenter.heroku.com/articles/scheduler">Scheduler addon</a> (Heroku):</p>

<ul>
<li>
<code>rake cleanup</code> (daily, 4am)</li>
<li>
<code>rake news:update</code> (daily, suggested 7am)</li>
<li>
<code>rake digests:daily</code> (daily, 8am)</li>
<li>
<code>rake digests:weekly</code> (weekly, but you can schedule it daily and it will only run on Sunday)</li>
</ul>

<p>If using dokku, your crontab should look something like this:</p>

<pre><code>0 4 * * * dokku run yourappname rake cleanup
0 7 * * * dokku run yourappname rake news:update
0 8 * * * dokku run yourappname rake digests:daily
0 0 * * 0 dokku run yourappname rake digests:weekly
</code></pre>

<h3>
<a id="4-check-dns" class="anchor" href="#4-check-dns" aria-hidden="true"><span class="octicon octicon-link"></span></a>4. Check DNS</h3>

<ul>
<li>For mail delivery <code>yourdomain.org MX mail.yourdomain.org</code> and <code>mail.yourdomain.org A {your VPS IP}</code>
</li>
<li>SPF <code>yourdomain.org TXT "v=spf1 a mx a:yourdomain.org ip4:{your VPS IP} ?all"</code>
</li>
<li>DKIM: see DKIM guide above</li>
</ul>

<p>If using a custom domain with Heroku you'll also have something like <code>www.yourdomain.org CNAME yourappname.herokuapp.com</code>. 
You can also make use of <a href="http://wwwizer.com">wwwizer.com</a>'s free naked domain redirect <code>yourdomain.org A 174.129.25.170</code>.</p>

<h3>
<a id="5-configuration" class="anchor" href="#5-configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>5. Configuration</h3>

<p>Visit <a href="http://www.yourdomain.org">www.yourdomain.org</a> for the first time. (You should be automatically logged in as an administrator. If not, sign in with the email address '<a href="mailto:admin@example.com">admin@example.com</a>' and the password 'lumen'.) Change the admin name, email address and password. Click 'Lumen configuration' in the footer and complete the configuration. You're done!</p>

<h2>
<a id="switching-mail-servers" class="anchor" href="#switching-mail-servers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Switching mail servers</h2>

<p>If you switch your mail server, you'll need to re-setup the group mail accounts on the new server. Fire up a console (<code>padrino c</code>) and run:</p>

<pre><code>Group.each { |group| group.setup_mail_accounts_and_forwarder }
ConversationPost.update_all(imap_uid: nil)
</code></pre>

<h2>
<a id="gallery" class="anchor" href="#gallery" aria-hidden="true"><span class="octicon octicon-link"></span></a> Gallery</h2>

<h3>
<a id="homepage-amalgamates-newsfeeds-from-all-groups" class="anchor" href="#homepage-amalgamates-newsfeeds-from-all-groups" aria-hidden="true"><span class="octicon octicon-link"></span></a>Homepage (amalgamates newsfeeds from all groups)</h3>

<p><a href="http://wordsandwriting.github.io/lumen/images/home.jpg"><img src="http://wordsandwriting.github.io/lumen/images/home.jpg"></a></p>

<h3>
<a id="home-calendar-amalgamates-events-from-all-groups" class="anchor" href="#home-calendar-amalgamates-events-from-all-groups" aria-hidden="true"><span class="octicon octicon-link"></span></a>Home calendar (amalgamates events from all groups)</h3>

<p><a href="http://wordsandwriting.github.io/lumen/images/calendar.jpg"><img src="http://wordsandwriting.github.io/lumen/images/calendar.jpg"></a></p>

<h3>
<a id="a-group" class="anchor" href="#a-group" aria-hidden="true"><span class="octicon octicon-link"></span></a>A group</h3>

<p><a href="http://wordsandwriting.github.io/lumen/images/group.jpg"><img src="http://wordsandwriting.github.io/lumen/images/group.jpg"></a></p>

<h3>
<a id="a-group-digest" class="anchor" href="#a-group-digest" aria-hidden="true"><span class="octicon octicon-link"></span></a>A group digest</h3>

<p><a href="http://wordsandwriting.github.io/lumen/images/digest.jpg"><img src="http://wordsandwriting.github.io/lumen/images/digest.jpg"></a></p>

<h3>
<a id="a-groups-map" class="anchor" href="#a-groups-map" aria-hidden="true"><span class="octicon octicon-link"></span></a>A group's map</h3>

<p><a href="http://wordsandwriting.github.io/lumen/images/map.jpg"><img src="http://wordsandwriting.github.io/lumen/images/map.jpg"></a></p>

<h3>
<a id="a-profile" class="anchor" href="#a-profile" aria-hidden="true"><span class="octicon octicon-link"></span></a>A profile</h3>

<p><a href="http://wordsandwriting.github.io/lumen/images/profile.jpg"><img src="http://wordsandwriting.github.io/lumen/images/profile.jpg"></a></p>

<h3>
<a id="email-accounts-corresponding-to-groups" class="anchor" href="#email-accounts-corresponding-to-groups" aria-hidden="true"><span class="octicon octicon-link"></span></a>Email accounts corresponding to groups</h3>

<p><a href="http://wordsandwriting.github.io/lumen/images/virtualmin.jpg"><img src="http://wordsandwriting.github.io/lumen/images/virtualmin.jpg"></a></p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/wordsandwriting">wordsandwriting</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>